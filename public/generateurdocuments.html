<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>RGPD Trankility - G√©n√©rateur de documents</title>
    <link rel="stylesheet" href="style.css">
</head>
    <header>
	  <div class="logo">
		<a href="index.html">
          <img src="images/logo_rgpd_trankility.png" alt="Logo RGPD Trankility">
		</a>
	  </div>
        <nav>
            <a href="login.html" id="logoutBtn">D√©connexion</a>
        </nav>
    </header>
<body>
  <h1>üßæ G√©n√©rateur de documents</h1>

  <div class="form-container">
    <form id="form">

      <!-- √âtape 1 -->
      <div class="form-step active">
		<h2>Informations personnelles du dirigeant</h2>
        <input type="text" id="nom" placeholder="Nom" required>
        <input type="text" id="prenom" placeholder="Pr√©nom" required>
        <div class="buttons">
          <button type="button" id="next1">Suivant</button>
        </div>
      </div>

      <!-- √âtape 2 -->
      <div class="form-step">
		<h2>Informations de la soci√©t√©</h2>
        <input type="text" id="entreprise" placeholder="Nom de soci√©t√©" required>
		<input type="text" id="sigle" placeholder="Sigle de la soci√©t√©">
		<input type="text" id="adressesiege" placeholder="Adresse du si√®ge" required>
		<input type="text" id="cpsiege" placeholder="Code Postal" required>
		<input type="text" id="villesiege" placeholder="Ville" required>
		<input type="text" id="numtelsiege" placeholder="Num√©ro de t√©l√©phone" required>
        <div class="buttons">
          <button type="button" id="prev2">Pr√©c√©dent</button>
          <button type="button" id="next2">Suivant</button>
        </div>
      </div>

      <!-- √âtape 3 : R√©sum√© / validation -->
      <div class="form-step">
        <p>V√©rifiez vos informations puis validez :</p>
        <div id="summary"></div>
        <div class="buttons">
          <button type="button" id="prev3">Pr√©c√©dent</button>
          <button type="submit">Valider</button>
        </div>
      </div>

    </form>
  </div>

  <div id="result" style="margin-top: 20px;"></div>


  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const steps = document.querySelectorAll(".form-step");
      let currentStep = 0;

      function showStep(index) {
        steps.forEach((step, i) => step.classList.toggle("active", i === index));
        currentStep = index;
      }

      // Boutons Suivant / Pr√©c√©dent
      document.getElementById("next1").addEventListener("click", () => showStep(1));
      document.getElementById("prev2").addEventListener("click", () => showStep(0));
      document.getElementById("next2").addEventListener("click", () => {
        // Affiche le r√©sum√©
        const summary = document.getElementById("summary");
        summary.innerHTML = `
		  <h3>Informations personnelles du dirigeant</h3>
          <strong>Nom :</strong> ${document.getElementById("nom").value}<br>
          <strong>Pr√©nom :</strong> ${document.getElementById("prenom").value}<br>
		  <h3>Informations de la soci√©t√©</h3>
          <strong>Entreprise :</strong> ${document.getElementById("entreprise").value}<br>
          <strong>Sigle de la soci√©t√© :</strong> ${document.getElementById("sigle").value}<br>
		  <strong>Adresse du si√®ge :</strong> ${document.getElementById("adressesiege").value}<br>
		  <strong>Code Postal :</strong> ${document.getElementById("cpsiege").value}<br>
		  <strong>Ville :</strong> ${document.getElementById("villesiege").value}<br>
		  <strong>Num√©ro de t√©l√©phone :</strong> ${document.getElementById("numtelsiege").value}
        `;
        showStep(2);
      });
      document.getElementById("prev3").addEventListener("click", () => showStep(1));

      // Soumission finale
      document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();

        const nom = document.getElementById("nom").value.trim();
        const prenom = document.getElementById("prenom").value.trim();
        const entreprise = document.getElementById("entreprise").value.trim();
        const sigle = document.getElementById("sigle").value.trim();
        const adressesiege = document.getElementById("adressesiege").value.trim();
        const cpsiege = document.getElementById("cpsiege").value.trim();
        const villesiege = document.getElementById("villesiege").value.trim();
        const numtelsiege = document.getElementById("numtelsiege").value.trim();
		
        const result = document.getElementById("result");
        result.textContent = "‚è≥ G√©n√©ration en cours...";

        try {
			const res = await fetch("/generate", {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ nom, prenom, entreprise, sigle, adressesiege, cpsiege, villesiege, numtelsiege }),
			});

          const data = await res.json();

          if (res.ok && data.pdfUrl && data.docxUrl && data.zipUrl) {
            result.innerHTML = `
              ‚úÖ Documents g√©n√©r√©s !
              <a href="${data.pdfUrl}" download><button>T√©l√©charger le PDF</button></a>
              <a href="${data.docxUrl}" download><button>T√©l√©charger le Word</button></a>
              <a href="${data.zipUrl}" download><button>T√©l√©charger le ZIP</button></a>
            `;
		// Sauvegarde dans localStorage pour l'historique
		const currentUser = JSON.parse(localStorage.getItem('currentUser'));
		if (currentUser) {
			const historyKey = `history_${currentUser.name}`;
			let history = JSON.parse(localStorage.getItem(historyKey)) || [];
			history.push({
				date: new Date().toLocaleString(),
				pdfUrl: data.pdfUrl,
				docxUrl: data.docxUrl,
				zipUrl: data.zipUrl
			});
			localStorage.setItem(historyKey, JSON.stringify(history));
			}
          } else {
            result.textContent = `‚ùå Erreur lors de la g√©n√©ration : ${data.error || "unknown"}`;
          }
        } catch (err) {
          console.error(err);
          result.textContent = "‚ùå Erreur r√©seau ou serveur.";
        }
      });
    });
  </script>
	<script src="header.js"></script>
</body>
</html>
